<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>Blazor WinForms app</title>
    <base href="/"/>
    <link rel="stylesheet" href="_content/css/bootstrap/bootstrap.min.css"/>
    <link href="_content/SharedLibrary/css/site.css" rel="stylesheet"/>
    <link href="WinForms.styles.css" rel="stylesheet"/>

    <!-- For MudBlazor below -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet"/>
    <link href="_content/MudBlazor/MudBlazor.min.css" rel="stylesheet"/>
</head>

<body>

<div id="app">Loading...</div>

<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">🗙</a>
</div>

<!-- For MudBlazor below -->
<script src="_content/MudBlazor/MudBlazor.min.js"></script>
<script src="_framework/blazor.webview.js"></script>

<!-- Helper functions for responsive dialog sizing -->
<script>
    // Get element size for responsive dialogs
    window.getElementSize = (element) => {
        if (!element) return { width: 0, height: 0 };
        const rect = element.getBoundingClientRect();
        return { width: rect.width, height: rect.height };
    };

    // ResizeObserver management for crop dialog
    window.cropDialogResizeObservers = new Map();

    window.setupCropDialogResizeObserver = (element, dotNetRef) => {
        if (!element) return;
        
        // Remove any existing observer for this element
        window.removeCropDialogResizeObserver(element);
        
        const observer = new ResizeObserver(entries => {
            // Debounce to avoid excessive calls
            if (observer._timeout) clearTimeout(observer._timeout);
            observer._timeout = setTimeout(() => {
                dotNetRef.invokeMethodAsync('OnContainerResized');
            }, 100);
        });
        
        observer.observe(element);
        window.cropDialogResizeObservers.set(element, observer);
    };

    window.removeCropDialogResizeObserver = (element) => {
        if (!element) return;
        const observer = window.cropDialogResizeObservers.get(element);
        if (observer) {
            if (observer._timeout) clearTimeout(observer._timeout);
            observer.disconnect();
            window.cropDialogResizeObservers.delete(element);
        }
    };

    // ResizeObserver management for feature selector dialog
    window.featureSelectorResizeObservers = new Map();

    window.setupFeatureSelectorResizeObserver = (element, dotNetRef) => {
        if (!element) return;
        
        // Remove any existing observer for this element
        window.removeFeatureSelectorResizeObserver(element);
        
        const observer = new ResizeObserver(entries => {
            // Debounce to avoid excessive calls
            if (observer._timeout) clearTimeout(observer._timeout);
            observer._timeout = setTimeout(() => {
                dotNetRef.invokeMethodAsync('OnPreviewContainerResized');
            }, 100);
        });
        
        observer.observe(element);
        window.featureSelectorResizeObservers.set(element, observer);
    };

    window.removeFeatureSelectorResizeObserver = (element) => {
        if (!element) return;
        const observer = window.featureSelectorResizeObservers.get(element);
        if (observer) {
            if (observer._timeout) clearTimeout(observer._timeout);
            observer.disconnect();
            window.featureSelectorResizeObservers.delete(element);
        }
    };
</script>
</body>

</html>