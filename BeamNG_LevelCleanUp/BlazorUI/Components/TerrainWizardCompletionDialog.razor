@using MudBlazor

<MudDialog>
    <DialogContent>
        <MudStack Spacing="4">
            <MudAlert Severity="Severity.Success" Variant="Variant.Filled" Icon="@Icons.Material.Filled.CheckCircle">
                <MudText Typo="Typo.h6">Terrain Generated Successfully!</MudText>
            </MudAlert>

            @if (CopySucceeded)
            {
                <MudAlert Severity="Severity.Success" Dense="true" Icon="@Icons.Material.Filled.Folder">
                    <MudText Typo="Typo.body1">
                        Your level <b>@LevelName</b> has been automatically copied to the BeamNG levels folder.
                        You can launch BeamNG.drive and test your terrain right away.
                    </MudText>
                </MudAlert>
            }
            else if (!string.IsNullOrEmpty(CopyErrorMessage))
            {
                <MudAlert Severity="Severity.Warning" Dense="true" Icon="@Icons.Material.Filled.Warning">
                    <MudText Typo="Typo.body1">
                        Could not auto-copy level to BeamNG levels folder: @CopyErrorMessage
                    </MudText>
                    <MudText Typo="Typo.body2" Class="mt-1">
                        You can manually copy the level later from the Create Level page.
                    </MudText>
                </MudAlert>
            }

            <MudPaper Class="pa-4" Elevation="2">
                <MudStack Spacing="3">
                    <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                        <MudStack Row="true" AlignItems="AlignItems.Center">
                            <MudAvatar Color="Color.Primary" Size="Size.Small">1</MudAvatar>
                            <MudText Typo="Typo.body1">
                                <strong>Save Your Preset</strong> — Export your terrain settings so you can
                                reload and refine them later.
                            </MudText>
                        </MudStack>
                        <MudButton Variant="Variant.Filled"
                                   Color="Color.Primary"
                                   StartIcon="@Icons.Material.Filled.Download"
                                   OnClick="ExportPreset"
                                   Size="Size.Small">
                            Export Preset
                        </MudButton>
                    </MudStack>

                    <MudStack Row="true" AlignItems="AlignItems.Center">
                        <MudAvatar Color="Color.Primary" Size="Size.Small">2</MudAvatar>
                        <MudText Typo="Typo.body1">
                            <strong>Test & Refine</strong> — Launch BeamNG to test your terrain. Come back to
                            the Generate Terrain page anytime to load your preset and regenerate with adjustments.
                        </MudText>
                    </MudStack>
                </MudStack>
            </MudPaper>

            @if (!string.IsNullOrEmpty(TerrainFilePath))
            {
                <MudAlert Severity="Severity.Info" Dense="true" Icon="@Icons.Material.Filled.FolderOpen">
                    <MudText Typo="Typo.caption">
                        <strong>Terrain file:</strong> @TerrainFilePath
                    </MudText>
                </MudAlert>
            }
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Close"
                   Variant="Variant.Filled"
                   Color="Color.Primary"
                   StartIcon="@Icons.Material.Filled.Check">
            Finish Wizard
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; }

    [Parameter]
    public string TerrainFilePath { get; set; }

    [Parameter]
    public string LevelName { get; set; }

    [Parameter]
    public bool CopySucceeded { get; set; }

    [Parameter]
    public string CopyErrorMessage { get; set; }

    [Parameter]
    public EventCallback OnExportPreset { get; set; }

    private async Task ExportPreset()
    {
        if (OnExportPreset.HasDelegate)
            await OnExportPreset.InvokeAsync();
    }

    private void Close()
    {
        MudDialog.Close(DialogResult.Ok(true));
    }
}
