@using DialogResult = System.Windows.Forms.DialogResult
@if (!string.IsNullOrEmpty(Title))
{
    <MudText Typo="Typo.h6">@Title</MudText>
}
@if (!string.IsNullOrEmpty(Description))
{
    <MudText>@Description</MudText>
}
@if (!string.IsNullOrEmpty(_selectedFile))
{
    <MudListItem T="string" Icon="@Icons.Material.Filled.AttachFile" @key="@_selectedFile">
        @_selectedFile
    </MudListItem>
}
@if (!SelectFolder)
{
    <MudButton HtmlTag="label"
               Variant="Variant.Filled"
               Color="Color.Primary"
               StartIcon="@Icons.Material.Filled.FileOpen"
               OnClick="OpenFile"
               Disabled="@Disabled">
        Select File
    </MudButton>
}
else
{
    <MudButton HtmlTag="label"
               Variant="Variant.Filled"
               Color="Color.Primary"
               StartIcon="@Icons.Material.Filled.FolderOpen"
               OnClick="OpenFolder"
               Disabled="@Disabled">
        Select Folder
    </MudButton>
}

@code {
    [Parameter] public string Title { get; set; }
    [Parameter] public string Description { get; set; }
    [Parameter] public EventCallback<string> OnFileSelected { get; set; }
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public bool SelectFolder { get; set; }
    private OpenFileDialog OpenFileDialog { get; } = new();
    private FolderBrowserDialog FolderBrowserDialog { get; } = new();
    private string _selectedFile { get; set; } = string.Empty;

    private async Task OpenFile()
    {
        OpenFileDialog.Filter = "Zipfiles (*.zip)|*.zip";
        OpenFileDialog.FileName = string.Empty;
        try
        {
            var result = OpenFileDialog.ShowDialog();
            if (result == DialogResult.OK)
            {
                _selectedFile = OpenFileDialog.FileName;
                await OnFileSelected.InvokeAsync(_selectedFile);
            }
        }
        catch (Exception ex)
        {
            throw ex;
        }
    }

    private async Task OpenFolder()
    {
        try
        {
            var result = FolderBrowserDialog.ShowDialog();
            if (result == DialogResult.OK)
            {
                _selectedFile = FolderBrowserDialog.SelectedPath;
                await OnFileSelected.InvokeAsync(_selectedFile);
            }
        }
        catch (Exception ex)
        {
            throw ex;
        }
    }

}