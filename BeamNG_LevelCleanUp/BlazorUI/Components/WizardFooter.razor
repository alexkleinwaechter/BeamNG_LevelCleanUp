@using BeamNG_LevelCleanUp.Objects
@using BeamNG_LevelCleanUp.Communication
@inject NavigationManager Navigation

@* 
    Unified Footer Component for Wizard Pages
    This component renders EITHER:
    - Wizard mode: Progress chips + status + action buttons (all in one footer)
    - Standalone mode: Just the action buttons passed via RenderFragment
*@

@if (WizardMode && WizardState?.IsActive == true)
{
    <footer class="wizard-footer">
        @* Row 1: Progress Chips and Summary *@
        <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center" Class="mb-2">
            <MudStack Row="true" Spacing="2" Class="flex-wrap">
                <MudChip T="string" Size="Size.Small" Color="@GetStepColor(0)" Icon="@Icons.Material.Filled.Settings">Setup</MudChip>
                <MudChip T="string" Size="Size.Small" Color="@GetStepColor(1)" Icon="@Icons.Material.Filled.Layers">MissionGroups</MudChip>
                <MudChip T="string" Size="Size.Small" Color="@GetStepColor(2)" Icon="@Icons.Material.Filled.Terrain">Terrains</MudChip>
                <MudChip T="string" Size="Size.Small" Color="@GetStepColor(3)" Icon="@Icons.Material.Filled.Forest">Forest</MudChip>
                <MudChip T="string" Size="Size.Small" Color="@GetStepColor(4)" Icon="@Icons.Material.Filled.ContentCopy">Assets</MudChip>
                <MudChip T="string" Size="Size.Small" Color="@GetStepColor(5)" Icon="@Icons.Material.Filled.Landscape">Generate</MudChip>
            </MudStack>
            
            <MudText Typo="Typo.caption" Color="Color.Primary">
                @WizardState.GetProgressSummary() @(string.IsNullOrEmpty(WizardState.LevelName) ? "" : $" | Target: {WizardState.LevelName}")
            </MudText>
        </MudStack>

        @* Row 2: Page-specific selection info (if provided) *@
        @if (SelectionInfo != null)
        {
            <div class="mb-2">
                @SelectionInfo
            </div>
        }
        
        @* Row 3: Action Buttons *@
        <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center" Class="flex-wrap" Style="gap: 8px;">
            @* Left side: Back/Cancel button (only show if there's a back action) *@
            @if (!string.IsNullOrEmpty(BackButtonText) && WizardState.CurrentStep > 0)
            {
                <MudButton OnClick="@OnBackClick" 
                          Variant="Variant.Outlined"
                          StartIcon="@Icons.Material.Filled.ArrowBack"
                          Size="Size.Small">
                    @BackButtonText
                </MudButton>
            }
            else
            {
                <div></div> @* Spacer for flex layout *@
            }
            
            @* Center: Page-specific action buttons *@
            <MudStack Row="true" Spacing="2" AlignItems="AlignItems.Center">
                @if (ActionButtons != null)
                {
                    @ActionButtons
                }
            </MudStack>
            
            @* Right side: Next/Finish button *@
            <MudStack Row="true" Spacing="2">
                @if (ShowSkipButton)
                {
                    <MudButton OnClick="@OnSkipClick"
                              Variant="Variant.Outlined"
                              StartIcon="@Icons.Material.Filled.SkipNext"
                              Size="Size.Small">
                        Skip Step
                    </MudButton>
                }
                
                @if (ShowNextButton)
                {
                    <MudButton OnClick="@OnNextClick" 
                              Variant="Variant.Filled" 
                              Color="Color.Primary"
                              EndIcon="@Icons.Material.Filled.ArrowForward"
                              Size="Size.Small"
                              Disabled="@(!CanProceed)">
                        @NextButtonText
                    </MudButton>
                }
                
                @if (ShowFinishButton)
                {
                    <MudButton OnClick="@OnFinishClick"
                              Variant="Variant.Filled"
                              Color="Color.Success"
                              StartIcon="@Icons.Material.Filled.Check"
                              Size="Size.Small">
                        Finish Wizard
                    </MudButton>
                }
            </MudStack>
        </MudStack>
        
        @* Row 4: Working directory links (if available) *@
        @if (FooterLinks != null)
        {
            <div class="mt-2">
                @FooterLinks
            </div>
        }
    </footer>
}
else
{
    @* Standalone mode: Simple footer with action buttons *@
    <footer class="standalone-footer">
        @if (SelectionInfo != null)
        {
            <div class="mb-2">
                @SelectionInfo
            </div>
        }
        
        <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center" Class="flex-wrap" Style="gap: 8px;">
            @if (ActionButtons != null)
            {
                @ActionButtons
            }
        </MudStack>
        
        @if (FooterLinks != null)
        {
            <div class="mt-2">
                @FooterLinks
            </div>
        }
    </footer>
}

@code {
    /// <summary>
    /// Whether the page is in wizard mode
    /// </summary>
    [Parameter]
    public bool WizardMode { get; set; }

    /// <summary>
    /// The wizard state (required when WizardMode is true)
    /// </summary>
    [Parameter]
    public CreateLevelWizardState WizardState { get; set; }

    /// <summary>
    /// Selection info text (e.g., "Selected: 5 items, Size: 10 MB")
    /// </summary>
    [Parameter]
    public RenderFragment SelectionInfo { get; set; }

    /// <summary>
    /// Page-specific action buttons (e.g., Copy, Errors, Warnings buttons)
    /// </summary>
    [Parameter]
    public RenderFragment ActionButtons { get; set; }

    /// <summary>
    /// Footer links (e.g., Working Directory, Logfiles)
    /// </summary>
    [Parameter]
    public RenderFragment FooterLinks { get; set; }

    /// <summary>
    /// Text for the back button
    /// </summary>
    [Parameter]
    public string BackButtonText { get; set; } = "Back";

    /// <summary>
    /// Text for the next/proceed button
    /// </summary>
    [Parameter]
    public string NextButtonText { get; set; } = "Continue";

    /// <summary>
    /// Whether the user can proceed to the next step
    /// </summary>
    [Parameter]
    public bool CanProceed { get; set; }

    /// <summary>
    /// Whether to show the skip button
    /// </summary>
    [Parameter]
    public bool ShowSkipButton { get; set; }

    /// <summary>
    /// Whether to show the next button
    /// </summary>
    [Parameter]
    public bool ShowNextButton { get; set; } = true;

    /// <summary>
    /// Whether to show the finish button
    /// </summary>
    [Parameter]
    public bool ShowFinishButton { get; set; }

    /// <summary>
    /// Callback when back button is clicked
    /// </summary>
    [Parameter]
    public EventCallback OnBackClick { get; set; }

    /// <summary>
    /// Callback when next button is clicked
    /// </summary>
    [Parameter]
    public EventCallback OnNextClick { get; set; }

    /// <summary>
    /// Callback when skip button is clicked
    /// </summary>
    [Parameter]
    public EventCallback OnSkipClick { get; set; }

    /// <summary>
    /// Callback when finish button is clicked
    /// </summary>
    [Parameter]
    public EventCallback OnFinishClick { get; set; }

    private Color GetStepColor(int step)
    {
        if (WizardState == null) return Color.Default;
        
        if (step < WizardState.CurrentStep)
            return Color.Success;
        if (step == WizardState.CurrentStep)
            return Color.Primary;
        return Color.Default;
    }
}
